--[[
    PROJECT: RESPAWN (v5.0 - PHOENIX RECODE)
    Status: FIXED & VISIBLE
    
    Change Log:
    - Sidebar width increased to 150px (Text + Icon support)
    - Added Vertical Separator Line (Visual clarity)
    - Contrast adjustments (You can actually see the panels now)
    - robust Icon Loading
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

local Respawn = {}
Respawn.__index = Respawn

--// 1.0 CONFIGURATION
local Config = {
    Name = "Respawn",
    Folder = "RespawnCache",
    TweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
}

local Theme = {
    -- High Visibility Dark Mode
    Window      = Color3.fromRGB(15, 15, 15),       -- Main Background
    Sidebar     = Color3.fromRGB(10, 10, 10),       -- Sidebar Background (Darker)
    Topbar      = Color3.fromRGB(12, 12, 12),       -- Header
    
    Lines       = Color3.fromRGB(45, 45, 45),       -- Distinct Separators
    
    Accent      = Color3.fromRGB(0, 122, 204),      -- Default Blue (Changeable)
    Text        = Color3.fromRGB(255, 255, 255),    -- White
    TextDim     = Color3.fromRGB(150, 150, 150),    -- Grey
    
    Hover       = Color3.fromRGB(25, 25, 25),       -- Button Hover
    Section     = Color3.fromRGB(20, 20, 20),       -- Inner Containers
}

--// 2.0 UTILITY
local Utility = {}

function Utility.Create(class, props, children)
    local inst = Instance.new(class)
    for k, v in pairs(props or {}) do inst[k] = v end
    for _, child in ipairs(children or {}) do child.Parent = inst end
    return inst
end

function Utility.Tween(inst, props)
    TweenService:Create(inst, Config.TweenInfo, props):Play()
end

function Utility.Drag(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Utility.Tween(frame, {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)})
        end
    end)
end

-- [ ROBUST ICON LOADER ] --
function Utility.GetIcon(name)
    if not name then return "" end
    if string.find(name, "rbxassetid") then return name end
    
    -- File System Check
    if not writefile or not makefolder or not getcustomasset then 
        return "rbxassetid://0" -- Fallback for basic executors
    end
    
    local fileName = name .. ".png"
    local path = Config.Folder .. "/" .. fileName
    local url = "https://raw.githubusercontent.com/latte-soft/lucide-roblox/master/icons/compiled/48px/" .. fileName
    
    if not isfolder(Config.Folder) then makefolder(Config.Folder) end
    
    if not isfile(path) then
        local success, response = pcall(function() return game:HttpGet(url) end)
        if success then
            writefile(path, response)
        else
            warn("Failed to load icon:", name)
            return "rbxassetid://0"
        end
    end
    return getcustomasset(path)
end

--// 3.0 GLOBAL STATE
local UI = {
    Window = nil,
    Sidebar = nil,
    PageContainer = nil,
    NotifyList = nil,
    ActiveTab = nil
}

--// 4.0 INITIALIZER
function Respawn.init(targetGui)
    if UI.Window then UI.Window:Destroy() end -- Reset if exists
    
    local gui = Utility.Create("ScreenGui", {Parent = targetGui, Name = "RespawnPhoenix", ResetOnSpawn = false, ZIndexBehavior = Enum.ZIndexBehavior.Sibling})
    
    -- 1. Main Window
    local win = Utility.Create("Frame", {
        Parent = gui, Size = UDim2.fromOffset(650, 400),
        Position = UDim2.fromScale(0.5, 0.5), AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Theme.Window, BorderSizePixel = 0
    })
    Utility.Create("UICorner", {Parent = win, CornerRadius = UDim.new(0, 6)})
    Utility.Create("UIStroke", {Parent = win, Color = Theme.Lines, Thickness = 1})
    
    -- 2. Topbar
    local top = Utility.Create("Frame", {
        Parent = win, Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = Theme.Topbar, BorderSizePixel = 0
    })
    Utility.Create("UICorner", {Parent = top, CornerRadius = UDim.new(0, 6)})
    -- Hides bottom rounded corners of topbar
    Utility.Create("Frame", {
        Parent = top, Size = UDim2.new(1, 0, 0, 10), Position = UDim2.new(0, 0, 1, -10),
        BackgroundColor3 = Theme.Topbar, BorderSizePixel = 0
    })
    -- Separator Line (Top)
    Utility.Create("Frame", {
        Parent = top, Size = UDim2.new(1, 0, 0, 1), Position = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = Theme.Lines, BorderSizePixel = 0
    })
    
    Utility.Create("TextLabel", {
        Parent = top, Text = "RESPAWN // PHOENIX", TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold, TextSize = 14, BackgroundTransparency = 1,
        Size = UDim2.new(0.5, 0, 1, 0), Position = UDim2.new(0, 15, 0, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    Utility.Drag(win, top)
    
    -- 3. Sidebar (Distinct & Visible)
    local side = Utility.Create("ScrollingFrame", {
        Parent = win, Size = UDim2.new(0, 150, 1, -41), Position = UDim2.new(0, 0, 0, 41),
        BackgroundColor3 = Theme.Sidebar, BorderSizePixel = 0, ScrollBarThickness = 2
    })
    Utility.Create("UICorner", {Parent = side, CornerRadius = UDim.new(0, 6)})
    -- Hides right/top rounded corners
    Utility.Create("Frame", {
        Parent = side, Size = UDim2.new(0, 10, 1, 0), Position = UDim2.new(1, -10, 0, 0),
        BackgroundColor3 = Theme.Sidebar, BorderSizePixel = 0
    })
    
    -- Sidebar Layout
    Utility.Create("UIListLayout", {Parent = side, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)})
    Utility.Create("UIPadding", {Parent = side, PaddingTop = UDim.new(0, 10), PaddingLeft = UDim.new(0, 10), PaddingRight = UDim.new(0, 10)})

    -- Vertical Line (Separates Sidebar from Content)
    Utility.Create("Frame", {
        Parent = win, Size = UDim2.new(0, 1, 1, -41), Position = UDim2.new(0, 150, 0, 41),
        BackgroundColor3 = Theme.Lines, BorderSizePixel = 0, ZIndex = 5
    })
    
    -- 4. Content Container
    local content = Utility.Create("Frame", {
        Parent = win, Size = UDim2.new(1, -151, 1, -41), Position = UDim2.new(0, 151, 0, 41),
        BackgroundTransparency = 1, ClipsDescendants = true
    })
    
    -- 5. Notifications
    local notify = Utility.Create("Frame", {
        Parent = gui, Size = UDim2.new(0, 250, 1, 0), Position = UDim2.new(1, -260, 0, 20),
        BackgroundTransparency = 1
    })
    Utility.Create("UIListLayout", {Parent = notify, SortOrder = Enum.SortOrder.LayoutOrder, VerticalAlignment = Enum.VerticalAlignment.Bottom, Padding = UDim.new(0, 5)})
    
    UI.Window = win
    UI.Sidebar = side
    UI.PageContainer = content
    UI.NotifyList = notify
    
    return Respawn
end

--// 5.0 COMPONENTS

local TabClass = {}
TabClass.__index = TabClass

function Respawn:AddTab(name, iconName)
    if not UI.Sidebar then warn("[Respawn] Init not run!") return end
    
    local tab = {Name = name}
    
    -- Sidebar Button
    local btn = Utility.Create("TextButton", {
        Parent = UI.Sidebar, Size = UDim2.new(1, 0, 0, 35),
        BackgroundColor3 = Theme.Sidebar, AutoButtonColor = false,
        Text = "", BorderSizePixel = 0
    })
    Utility.Create("UICorner", {Parent = btn, CornerRadius = UDim.new(0, 6)})
    
    local btnContent = Utility.Create("Frame", {
        Parent = btn, Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1
    })
    Utility.Create("UIListLayout", {Parent = btnContent, FillDirection = Enum.FillDirection.Horizontal, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 10), VerticalAlignment = Enum.VerticalAlignment.Center})
    Utility.Create("UIPadding", {Parent = btnContent, PaddingLeft = UDim.new(0, 10)})
    
    -- Icon
    local icon = Utility.Create("ImageLabel", {
        Parent = btnContent, Size = UDim2.new(0, 20, 0, 20),
        BackgroundTransparency = 1, Image = Utility.GetIcon(iconName),
        ImageColor3 = Theme.TextDim, LayoutOrder = 1
    })
    
    -- Text
    local lbl = Utility.Create("TextLabel", {
        Parent = btnContent, Size = UDim2.new(0, 0, 0, 0), AutomaticSize = Enum.AutomaticSize.XY,
        BackgroundTransparency = 1, Text = name, TextColor3 = Theme.TextDim,
        Font = Enum.Font.GothamMedium, TextSize = 13, LayoutOrder = 2
    })
    
    -- Page
    local page = Utility.Create("ScrollingFrame", {
        Parent = UI.PageContainer, Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1, Visible = false, ScrollBarThickness = 2,
        BorderSizePixel = 0
    })
    Utility.Create("UIPadding", {Parent = page, PaddingTop = UDim.new(0, 15), PaddingLeft = UDim.new(0, 15), PaddingRight = UDim.new(0, 15), PaddingBottom = UDim.new(0, 15)})
    local layout = Utility.Create("UIListLayout", {Parent = page, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 8)})
    
    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 30)
    end)
    
    -- Logic
    btn.Activated:Connect(function()
        if UI.ActiveTab then
            UI.ActiveTab.Page.Visible = false
            Utility.Tween(UI.ActiveTab.Btn, {BackgroundColor3 = Theme.Sidebar})
            Utility.Tween(UI.ActiveTab.Txt, {TextColor3 = Theme.TextDim})
            Utility.Tween(UI.ActiveTab.Img, {ImageColor3 = Theme.TextDim})
        end
        
        UI.ActiveTab = {Page = page, Btn = btn, Txt = lbl, Img = icon}
        
        page.Visible = true
        Utility.Tween(btn, {BackgroundColor3 = Theme.Section})
        Utility.Tween(lbl, {TextColor3 = Theme.Text})
        Utility.Tween(icon, {ImageColor3 = Theme.Accent})
    end)
    
    -- First tab auto-select
    if not UI.ActiveTab then
        UI.ActiveTab = {Page = page, Btn = btn, Txt = lbl, Img = icon}
        page.Visible = true
        btn.BackgroundColor3 = Theme.Section
        lbl.TextColor3 = Theme.Text
        icon.ImageColor3 = Theme.Accent
    end
    
    setmetatable(tab, TabClass)
    tab.Container = page
    return tab
end

-- [ SECTION ] --
function TabClass:AddSection(text)
    local box = Utility.Create("Frame", {
        Parent = self.Container, Size = UDim2.new(1, 0, 0, 30), BackgroundTransparency = 1
    })
    Utility.Create("TextLabel", {
        Parent = box, Text = text, TextColor3 = Theme.Accent,
        Font = Enum.Font.GothamBold, TextSize = 12, BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0), TextXAlignment = Enum.TextXAlignment.Left
    })
end

-- [ BUTTON ] --
function TabClass:AddButton(text, callback)
    local btn = Utility.Create("TextButton", {
        Parent = self.Container, Size = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = Theme.Section, Text = text,
        TextColor3 = Theme.Text, Font = Enum.Font.Gotham, TextSize = 13,
        AutoButtonColor = false
    })
    Utility.Create("UICorner", {Parent = btn, CornerRadius = UDim.new(0, 4)})
    Utility.Create("UIStroke", {Parent = btn, Color = Theme.Lines, Thickness = 1})
    
    btn.MouseEnter:Connect(function() Utility.Tween(btn, {BackgroundColor3 = Theme.Hover}) end)
    btn.MouseLeave:Connect(function() Utility.Tween(btn, {BackgroundColor3 = Theme.Section}) end)
    btn.Activated:Connect(function()
        if callback then callback() end
        Utility.Tween(btn, {TextSize = 11})
        task.wait(0.1)
        Utility.Tween(btn, {TextSize = 13})
    end)
end

-- [ TOGGLE ] --
function TabClass:AddToggle(text, default, callback)
    local state = default or false
    local holder = Utility.Create("TextButton", {
        Parent = self.Container, Size = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = Theme.Section, AutoButtonColor = false, Text = ""
    })
    Utility.Create("UICorner", {Parent = holder, CornerRadius = UDim.new(0, 4)})
    Utility.Create("UIStroke", {Parent = holder, Color = Theme.Lines, Thickness = 1})
    
    local lbl = Utility.Create("TextLabel", {
        Parent = holder, Text = text, TextColor3 = Theme.Text,
        Font = Enum.Font.Gotham, TextSize = 13, BackgroundTransparency = 1,
        Size = UDim2.new(1, -40, 1, 0), Position = UDim2.new(0, 10, 0, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local check = Utility.Create("Frame", {
        Parent = holder, Size = UDim2.new(0, 18, 0, 18),
        Position = UDim2.new(1, -28, 0.5, -9), BackgroundColor3 = state and Theme.Accent or Theme.Window
    })
    Utility.Create("UICorner", {Parent = check, CornerRadius = UDim.new(0, 4)})
    
    holder.Activated:Connect(function()
        state = not state
        Utility.Tween(check, {BackgroundColor3 = state and Theme.Accent or Theme.Window})
        if callback then callback(state) end
    end)
end

-- [ SLIDER ] --
function TabClass:AddSlider(text, options, callback)
    local min, max, def = options.Min, options.Max, options.Default
    local val = def
    
    local box = Utility.Create("Frame", {
        Parent = self.Container, Size = UDim2.new(1, 0, 0, 50),
        BackgroundColor3 = Theme.Section
    })
    Utility.Create("UICorner", {Parent = box, CornerRadius = UDim.new(0, 4)})
    Utility.Create("UIStroke", {Parent = box, Color = Theme.Lines, Thickness = 1})
    
    Utility.Create("TextLabel", {
        Parent = box, Text = text, TextColor3 = Theme.Text,
        Font = Enum.Font.Gotham, TextSize = 13, BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 25), Position = UDim2.new(0, 10, 0, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local num = Utility.Create("TextLabel", {
        Parent = box, Text = tostring(val), TextColor3 = Theme.TextDim,
        Font = Enum.Font.Gotham, TextSize = 13, BackgroundTransparency = 1,
        Size = UDim2.new(0, 50, 0, 25), Position = UDim2.new(1, -55, 0, 0),
        TextXAlignment = Enum.TextXAlignment.Right
    })
    
    local bar = Utility.Create("Frame", {
        Parent = box, Size = UDim2.new(1, -20, 0, 4), Position = UDim2.new(0, 10, 0, 35),
        BackgroundColor3 = Theme.Window
    })
    Utility.Create("UICorner", {Parent = bar, CornerRadius = UDim.new(1, 0)})
    
    local fill = Utility.Create("Frame", {
        Parent = bar, Size = UDim2.new((val-min)/(max-min), 0, 1, 0),
        BackgroundColor3 = Theme.Accent
    })
    Utility.Create("UICorner", {Parent = fill, CornerRadius = UDim.new(1, 0)})
    
    local trigger = Utility.Create("TextButton", {
        Parent = bar, Size = UDim2.new(1, 0, 5, 0), Position = UDim2.new(0,0,-2,0),
        BackgroundTransparency = 1, Text = ""
    })
    
    local dragging = false
    trigger.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end end)
    UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
    UserInputService.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local p = math.clamp((i.Position.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
            val = math.floor(min + ((max-min) * p))
            fill.Size = UDim2.new(p, 0, 1, 0)
            num.Text = tostring(val)
            if callback then callback(val) end
        end
    end)
end

-- [ NOTIFY ] --
function Respawn:Notify(opts)
    local box = Utility.Create("Frame", {
        Parent = UI.NotifyList, Size = UDim2.new(1, 0, 0, 0), AutomaticSize = Enum.AutomaticSize.Y,
        BackgroundColor3 = Theme.Section, BackgroundTransparency = 0.1
    })
    Utility.Create("UICorner", {Parent = box, CornerRadius = UDim.new(0, 4)})
    Utility.Create("UIStroke", {Parent = box, Color = Theme.Lines, Thickness = 1})
    Utility.Create("UIPadding", {Parent = box, PaddingTop = UDim.new(0,10), PaddingBottom = UDim.new(0,10), PaddingLeft = UDim.new(0,10)})
    
    local title = Utility.Create("TextLabel", {
        Parent = box, Text = opts.Title or "Alert", TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold, TextSize = 14, BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 15), TextXAlignment = Enum.TextXAlignment.Left
    })
    
    Utility.Create("TextLabel", {
        Parent = box, Text = opts.Text or "Info", TextColor3 = Theme.TextDim,
        Font = Enum.Font.Gotham, TextSize = 12, BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 15), Position = UDim2.new(0,0,0,20),
        TextXAlignment = Enum.TextXAlignment.Left, TextWrapped = true
    })
    
    local bar = Utility.Create("Frame", {
        Parent = box, Size = UDim2.new(0, 3, 1, -10), Position = UDim2.new(0, -10, 0, 5),
        BackgroundColor3 = opts.Type == "Error" and Theme.Error or Theme.Accent
    })
    
    task.delay(opts.Duration or 3, function() box:Destroy() end)
end

return Respawn